

## Problem 30.

Solve Problem 21, the transportation problem with the addition of **flexible demands**. For each demand point, we do not require the exact requirement to be served. Instead, a **penalty** is introduced into the objective which is **proportional to the extent of the difference** between the required amount at a demand point and the actually served amount.

Two example problems will be solved, which differ only in the parameter constants.

-----

## Problem 31.

Solve Problem 22, the originally proposed transportation problem, with flexible demands added. There is a **surplus** and a **shortage penalty constant**. The penalty for each demand is calculated by multiplying the difference between the actual transported materials and the requirement by a corresponding penalty constant.

Two different scenarios are to be evaluated:

  * The **shortage penalty constant is 3**, and the **surplus penalty constant is 1**. This is the "**small**" penalty scenario.
  * The **shortage penalty constant is 15**, and the **surplus penalty constant is 10**. This is the "**large**" penalty scenario.

The starting point for implementation is the model with connections, from **Section 6.2**. The data content is expanded by two parameters, let's call them **`ShortagePenalty`** and **`SurplusPenalty`**. These can be given values in the data section according to the scenarios in Problem 31.

Let's investigate penalties as a function of the total materials delivered at a given demand point (**Figure 6**). **Linear penalty functions** are assumed in both directions. We can observe that this penalty can be considered a special cost function, which **decreases below** and **increases above** the actual requirement for the demand point. If the requirement is exactly met, the penalty is zero. Although the function curve is "broken" in a manner similar to the absolute value function, the **feasible region is still convex**, which suggests a **pure LP model** (Linear Programming).

The model is extended with an auxiliary variable, **`satisfied`**. This is defined for each demand and denotes the **total amount of materials delivered** to that demand. This helps in the formulation as the penalty for a demand $d$ is based on the difference between $\text{satisfied}[d]$ and $\text{Required}[d]$.

```
var satisfied {d in Demands}, >=0;
s.t. Calculating_Demand_Satisfied {d in Demands}:
satisfied[d] = sum {s in Supplies} tran[s,d];
```

From this point, two different methods are shown, which are applicable to penalties in general and are considered equally effective.

1.  The first method introduces a **single variable for the penalty itself**.
2.  The second method introduces **two variables for the shortage and the surplus** of materials.

### Method 1: Single Penalty Variable

The first method relies on the idea that the penalty function (a convex, piecewise linear function) can be correctly modeled by two linear constraints. This means that two linear constraints can achieve what we want.

```
var penalty {d in Demands}, >=0;
s.t. Shortage_Penalty_Constraint {d in Demands}:
penalty[d] >= ShortagePenalty * (Required[d] - satisfied[d]);
s.t. Surplus_Penalty_Constraint {d in Demands}:
penalty[d] >= SurplusPenalty * (satisfied[d] - Required[d]);
```

The first constraint ensures that the penalty is at least as defined for **shortage**. Note that this constraint is **redundant** if the demand is satisfied, as the right-hand side (RHS) becomes negative.

The second constraint ensures that the penalty is at least as defined for **surplus**. Similarly, this constraint becomes **redundant** if the demand is not met, as the RHS becomes negative.

The penalty variable can be directly included into the objective function, and the model formulation for the first method is ready. Note that the model allows penalty values higher than described as feasible solutions, but these are **eliminated by the optimization procedure**. That means, in the optimal solution, **one of the constraints will be binding (strict)**, or both will be non-binding if the requirement is exactly met and the penalty is zero.

```
minimize Total_Costs:
sum {(s,d) in Connections} tran[s,d] * Cost[s,d] +
sum {d in Demands} penalty[d];
```

### Method 2: Shortage and Surplus Variables

Let us see the second method for implementing flexible demands. This alternative way uses **more variables**, but **fewer constraints**. The exact shortage and surplus amounts are introduced as variables in this formulation.

```
var surplus {d in Demands}, >=0;
var shortage {d in Demands}, >=0;
s.t. Calculating_Exact_Demands {d in Demands}:
Required[d] - shortage[d] + surplus[d] = satisfied[d];
```

Note that the exactly transported amount, termed as $\text{satisfied}[d]$, is now the required amount, minus the shortage, plus the surplus—provided that **either variable is zero**, as common sense dictates. This is expressed by the constraint shown.

However, the model allows both the shortage and the surplus value to be increased by the same amount (e.g., $\text{shortage}' = \text{shortage} + \delta$ and $\text{surplus}' = \text{surplus} + \delta$, where $\delta > 0$), and everything else remains the same. But these cases will be **eliminated by the optimization procedure**, as the new variables are introduced into the objective with their corresponding penalty constants as factors. This completes the implementation of the second method. Note that the optimization procedure ensures that **either the shortage or the surplus is zero** in the optimal solution.

```
minimize Total_Costs:
sum {(s,d) in Connections} tran[s,d] * Cost[s,d] +
sum {d in Demands} (shortage[d] * ShortagePenalty +
surplus[d] * SurplusPenalty);
```

### Full Model (Method 1) and Results

The full model section for the **first method** is presented below. Remember that the two methods are equivalent.

```
set Supplies;
set Demands;
param Available {s in Supplies}, >=0;
param Required {d in Demands}, >=0;
set Connections := Supplies cross Demands;
param Cost {(s,d) in Connections}, >=0;
check sum {s in Supplies} Available[s] >= sum {d in Demands} Required[d];
param ShortagePenalty, >=0;
param SurplusPenalty, >=0;
var tran {(s,d) in Connections}, >=0;
var satisfied {d in Demands}, >=0;
var penalty {d in Demands}, >=0;
s.t. Calculating_Demand_Satisfied {d in Demands}:
satisfied[d] = sum {s in Supplies} tran[s,d];
s.t. Availability_at_Supply_Points {s in Supplies}:
sum {d in Demands} tran[s,d] <= Available[s];
s.t. Shortage_Penalty_Constraint {d in Demands}:
penalty[d] >= ShortagePenalty * (Required[d] - satisfied[d]);
s.t. Surplus_Penalty_Constraint {d in Demands}:
penalty[d] >= SurplusPenalty * (satisfied[d] - Required[d]);
minimize Total_Costs:
sum {(s,d) in Connections} tran[s,d] * Cost[s,d] +
sum {d in Demands} penalty[d];
solve;
printf "Optimal cost: %g.\n", Total_Costs;
for {d in Demands}
{
printf "Required: %s, Satisfied: %g (%+g)\n",
d, satisfied[d], satisfied[d]-Required[d];
}
for {(s,d) in Connections: tran[s,d] > 0}
{
printf "From %s to %s, transport %g amount for %g (unit cost: %g).\n",
s, d, tran[s,d], tran[s,d] * Cost[s,d], Cost[s,d];
}
end;
```

Regardless of which method we choose, the same result is obtained.

#### "Small" Penalty Scenario ($\text{ShortagePenalty}=3, \text{SurplusPenalty}=1$)

For the "small" penalty scenario, we can see that the total costs are cut by almost half.

```
Optimal cost: 1450.
Required: D1, Satisfied: 120 (+0)
Required: D2, Satisfied: 40 (-100)
Required: D3, Satisfied: 170 (+0)
Required: D4, Satisfied: 90 (+0)
Required: D5, Satisfied: 0 (-110)
Required: D6, Satisfied: 0 (-120)
From S2 to D1, transport 120 amount for 120 (unit cost: 1).
From S2 to D2, transport 40 amount for 80 (unit cost: 2).
From S2 to D4, transport 90 amount for 90 (unit cost: 1).
From S3 to D3, transport 170 amount for 170 (unit cost: 1).
```

There are **no surplus penalties**, but **vast shortages** for D2, D5, and D6. The latter two demand sites (D5 and D6) do not receive any materials at all. The reason is that the **unit cost of transportation exceeds the gain by satisfying the demand**. In the case of D2, the first 40 units can be transported for low costs, but the remaining part of the requirements cannot. The reason for not satisfying demands is that the shortage penalty constant of **3 is very low**, so it is worth not delivering any materials at all and incurring the shortage penalty instead of paying the transportation cost.

#### "Large" Penalty Scenario ($\text{ShortagePenalty}=15, \text{SurplusPenalty}=10$)

On the other hand, the "large" penalty scenario results in **exactly the same solution as the original transportation problem** without the penalties (optimal cost: 2,700). There is no surplus again, but **no shortages either**, simply because the shortage penalty of **15 per unit material is more costly than transporting the material** from any available supply. Therefore, there are no shortages.

There were **no surplus deliveries** in any case, which is not surprising. There had been no point in surplus delivery to any demand point in the original problem either, because it just increases the transportation costs. The surplus penalty just makes surplus even **less beneficial**. The case would be different if surplus deliveries were somehow needed—for example, if available supplies were required to be transported completely.

-----

## 6.7 Adding a Middle Level

In the former sections, different modeling techniques for cost functions and penalties were presented. Now, the transportation problem is expanded to a larger scale.

So far, the graph had been very simple: there were two sets of nodes in the network, the **supplies** and **demands**, and these were all directly connected. But what happens when the network is more complex, for example, if there is a **third set of nodes**?


