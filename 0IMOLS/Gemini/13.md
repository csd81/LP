## ðŸ“š Bookshelf Practice Example

**An example for a semester-end test**

-----

### Prerequisites

**Advanced modeling techniques:** "Redundant" variables

### The Problem

We've recently moved into a new apartment and need to organize our books onto a set of adjustable shelves. We have **seven** shelf plates whose height is variable. For this example, we assume that any height above **50 cm** is available, not just fixed positions. The plates are **120 cm wide, 20 cm deep, and 2 cm thick.**

Our books are grouped into **booksets** (e.g., math books, IT books, Tolkien novels, Harry Potter series, diplomas of formerly supervised students, etc.). For each bookset, we know the **total width** of the books and the **height of the tallest** book in that set.

Our **goal** is to arrange the booksets on the shelves to **minimize the maximum height** we must reach to access any book. To maintain order, we **cannot split up** any booksets, and we must also maintain a **7 cm gap** between the tallest book on a shelf and the shelf plate directly above it. However, we are **not required to use all** of the shelf plates if they aren't necessary.

-----

### Problem Data

The raw data for the problem is provided below:

| Set | Width (cm) | Height (cm) |
| :--- | :---: | :---: |
| Math | 100 | 20 |
| IT | 80 | 25 |
| Sport | 30 | 30 |
| Music | 50 | 30 |
| Novel | 40 | 20 |
| Tolkien | 30 | 25 |
| Feist | 50 | 20 |
| HarryPotter | 90 | 25 |
| Diplom | 70 | 40 |

$$
\begin{align*} \text{set } BookSets &:= \{Math, IT, Sport, Music, Novel, Tolkien, Feist, HarryPotter, Diplom\}; \\ \text{param } shelfCount &:= 7; \\ \text{param } shelfWidth &:= 120; \\ \text{param } shelfHeight &:= 2; \\ \text{param } minDistance &:= 7; \\ \text{param } minPosition &:= 50; \end{align*}
$$

-----

### Optimal Solution Example

To validate your model, here is **one** optimal arrangement of the books. Note that many permutations will yield the same objective value. It is simple to see that if shelves below the top-most one are simply exchanged, the objective function value will not change.

  * Novel
  * Feist
  * Math
  * IT
  * Sport
  * Tolkien
  * HarryPotter
  * Music
  * Diplom

-----

### The Model

Try to formulate the model yourself. **Hint:** Use **redundant variables** for the positioning of the shelves and for the height of the tallest book on a shelf.

```glpk
# Input data declaration

set BookSets;
param width{BookSets};
param height{BookSets};

param shelfCount;
set Shelves:=1..shelfCount;

param shelfWidth;
param shelfHeight;

param minDistance;
param minPosition;

param M:=500;


# Variables
var use{Shelves} binary; 
var position{Shelves} >= minPosition;
var put{BookSets,Shelves} binary;

var maxbookheight{Shelves}>=0;
var maxusedshelf;


# Constraints

# If a shelf is used, all the shelves below it must also be used
s.t. ShelfUsage {s in Shelves : s!=1}:
  use[s] <= use[s-1];


# Set the maximum book height for each shelf.
s.t. MaxBookHeightSetter{b in BookSets, s in Shelves}:
  maxbookheight[s] >= height[b] * put[b,s];
  
# If a shelf is used, its position must be higher than the one below it, including the book height, shelf thickness, and gap (maxbook + 7cm)
s.t. ShelfPositioning{s in Shelves: s!=1}:
  position[s] >= position[s-1]+maxbookheight[s-1]+shelfHeight+minDistance;


# Only put booksets on used shelves, and the total width must not exceed the shelf width
s.t. ShelfCapacity{s in Shelves}:
  sum{b in BookSets} put[b,s] * width[b] <= shelfWidth * use[s];

# Each bookset must be placed on exactly one shelf
s.t. BookSetAssignment{b in BookSets}:
  sum{s in Shelves} put[b,s] = 1;

# Set the maximum height reached by a used shelf. M is a large constant.
s.t. MaxUsedShelf{s in Shelves}:
  maxusedshelf >= position[s] - M *(1 - use[s]);

# Objective function

minimize topShelfHeight: maxusedshelf;

# Display statements
solve;


printf "<svg width='%d' height='%d'>",shelfWidth+20,(sum{ss in Shelves: (ss==shelfCount && use[ss]==1) || (use[ss]==1 && use[ss+1]==0)} (position[ss] + maxbookheight[ss]+shelfHeight)-position[1])+20; # <-- s/500/totalheight
for {s in Shelves : use[s]==1}
{

printf "<rect x='%d' y='%d' width='%d' height='%d' style='fill:rgb(214, 119, 36)' />",10,10+sum{ss in Shelves: (ss==shelfCount && use[ss]==1) || (use[ss]==1 && use[ss+1]==0)} (position[ss] + maxbookheight[ss]+shelfHeight)-position[s]-shelfHeight,shelfWidth,shelfHeight; # <-- s/500/totalheight
 for {b in BookSets : put[b,s]==1}
 {
    
    printf "<rect  x='%d' y='%d' width='%d' height='%d'"
    ,10+sum{b2 in BookSets : b2<b && put[b2,s]}width[b2]
    ,10+sum{ss in Shelves: (ss==shelfCount && use[ss]==1) || (use[ss]==1 && use[ss+1]==0)} (position[ss] + maxbookheight[ss]+shelfHeight)-(position[s]+shelfHeight)-height[b] # <-- s/500/totalheight
    ,width[b]
    ,height[b]
    ;
    printf " style='fill:rgb(%d,%d,80);stroke:black;stroke-width:1' />"
    ,(1-height[b]/maxbookheight[s])*100+155
    ,50+200*width[b]/shelfWidth
    ;

    printf "<text x='%d' y='%d' font-family='Verdana' font-size='6' fill='white'>%s</text>"    
    ,15+sum{b2 in BookSets : b2<b && put[b2,s]}width[b2]
    ,23+sum{ss in Shelves: (ss==shelfCount && use[ss]==1) || (use[ss]==1 && use[ss+1]==0)} (position[ss] + maxbookheight[ss]+shelfHeight)-(position[s]+shelfHeight)-height[b] # <-- s/500/totalheight
    ,b
    ;
 }
 

}
printf "</svg>";
```

**Observe the display statements at the end of the code; they generate the SVG figure shown above.**

-----

### Bonus Exercise

Imagine that we have a **given frequency** for all the booksets, which indicates how often we retrieve a book from that set, say, in a year. The most comfortable height for us to reach something is **120 cm**. Any position below or above that requires extra **"effort,"** which is **linear** to the difference from 120 cm. The task is to organize the books in such a way that our **overall effort over the year is minimal.**

 